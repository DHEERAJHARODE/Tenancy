<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>Agreement</title>
  <link href="https://fonts.googleapis.com/css2?family=Hind:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Hind', sans-serif; background-color: #f5f5f5; margin:0; display:flex; justify-content:center; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; }
    .page { width: 210mm; min-height: 297mm; background:white; padding:2px; box-shadow:0 0 20px rgba(0,0,0,0.1); border-radius:10px; display:flex; flex-direction:column; }
    .logo-container img { width:100%; display:block; margin:0; }
    .content { width:100%; background-color: rgba(255,255,255,0.95); padding:20px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.08); color:#333; font-size:18px; line-height:1.4; }
    h1 { text-align:center; font-weight:600; font-size:28px; margin:0; }
    .signature { margin-top:40px; text-align:right; }
    .signature img { width:160px; border:1px solid #ccc; padding:5px; border-radius:5px; background:#fff; }
    .btn-group { position:fixed; bottom:20px; left:0; right:0; text-align:center; z-index:1000; }
    button { padding:12px 25px; font-size:16px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer; margin:0 8px; transition:0.3s; }
    button:hover { background:#0056b3; }
    @media screen and (max-width:768px){ .page{width:100%; min-height:auto; box-shadow:none;} .content{font-size:16px;} .signature img{width:120px;} }
  </style>
</head>
<body oncontextmenu="return false;" onselectstart="return false;" ondragstart="return false;">
  <div class="page" id="capture-area">
    <div class="logo-container">
      <img src="/static/signature/logo.jpg" alt="Company Logo" />
    </div>

    <div class="content">
      <h1>Agreement</h1>
      <p><strong>नाम:</strong> {{ name }}</p>
      <p><strong>पिता/पति का नाम:</strong> {{ father_name }}</p>
      <p><strong>पता:</strong> {{ address }}</p>
      <p><strong>आधार नंबर:</strong> {{ aadhaar }}</p>
      <p><strong>पैन नंबर:</strong> {{ pan }}</p>
      <p><strong>मोबाइल नंबर:</strong> {{ mobile }}</p>

      <ul>
        <li>मैं हर महीने का किराया निर्धारित तिथि (प्रत्येक माह की 5 तारीख) तक मकान मालिक को समय पर जमा करूंगा।</li>
        <li>मैं कमरा खाली करने की स्थिति में कम से कम एक (1) माह पूर्व लिखित सूचना मकान मालिक को दूंगा। यदि मैं ऐसा नहीं करता, तो मैं अगले महीने का पूरा किराया जमा करूंगा।</li>
        <li>मैं अपने किराए के कमरे में किसी भी बाहरी व्यक्ति को बिना मकान मालिक की पूर्व अनुमति के नहीं ठहराऊंगा। यदि मैं ऐसा करता हूं, तो एक व्यक्ति के लिए प्रति रात ₹200/- के हिसाब से अतिरिक्त शुल्क जमा करूंगा।</li>
        <li>मैं कमरे में वॉटर हीटर, इंडक्शन या किसी अन्य भारी विद्युत उपकरण का उपयोग नहीं करूंगा। यदि मैं ऐसा करता हुआ पाया जाता हूँ, तो मकान मालिक मुझे किसी भी समय कमरा खाली करने के लिए बाध्य कर सकते हैं।</li>
        <li>मेरे द्वारा किराए के कमरे या उसमें उपलब्ध किसी भी वस्तु की कोई भी तोड़-फोड़ या क्षति होती है, तो उससे संबंधित संपूर्ण मरम्मत/बदलाव का खर्च मैं स्वयं वहन करूंगा और मकान मालिक को उसकी भरपाई करूंगा।</li>
        <li>मैं दीवारों पर कील ठोकने, पेंट/प्लास्टर को नुकसान पहुंचाने या कोई स्थायी परिवर्तन करने का कार्य नहीं करूंगा। यदि ऐसा करता हूँ तो उसका खर्च मेरी जमा राशि से काटा जाएगा या मुझे अलग से भुगतान करना होगा।</li>
        <li>मैं कमरे में साफ-सफाई बनाए रखूंगा और कोई अवैध कार्य नहीं करूंगा।</li>
        <li>उल्लंघन पर मकान मालिक बिना सूचना के कमरा खाली करवा सकते हैं और जमा राशि समायोजित कर सकते हैं।</li>
      </ul>

      <div class="signature">
        <p><strong>मैं उपरोक्त सभी शर्तों से पूर्णतः सहमत हूँ।</strong></p>
        <p>हस्ताक्षर:</p>
        <img src="{{ signature_url }}" alt="Signature" />
      </div>
    </div>
  </div>

  <div class="btn-group">
    <button id="uploadPageBtn">Upload & Save Agreement</button>
  </div>

  <script>
    document.getElementById("uploadPageBtn").addEventListener("click", async () => {
      const btn = document.getElementById("uploadPageBtn");
      btn.disabled = true;
      btn.innerText = "Uploading...";

      try {
        const captureArea = document.getElementById("capture-area");
        const canvas = await html2canvas(captureArea, { scale: 2, useCORS: true });
        const imageBlob = await new Promise(resolve => canvas.toBlob(resolve, "image/png"));

        const formData = new FormData();
        formData.append("image", imageBlob, "agreement_page.png");
        formData.append("name", "{{ name }}");

        const res = await fetch("/upload-page-image/", { method:"POST", body:formData });
        const data = await res.json();

        if(data.url){
          alert("✅ Agreement successfully uploaded!\nURL: " + data.url);
           // ✅ Success: Show thank you message in current page
          document.body.innerHTML = `
            <div style="display:flex; justify-content:center; align-items:center; height:100vh; text-align:center; flex-direction:column; font-family:'Hind',sans-serif; background:#f0f0f0; padding:20px;">
              <h1 style="color:#007bff;">धन्यवाद!</h1>
              <p style="font-size:18px; margin-top:10px;">
                आपके समय के लिए धन्यवाद।<br>
                कृपया सभी नियमों और शर्तों का पालन करें।
              </p>
            </div>`;
        } else {
          alert("❌ Upload failed: " + data.error);
        }
      } catch(err){
        alert("❌ Error: " + err.message);
      } finally {
        btn.disabled = false;
        btn.innerText = "Upload & Save Agreement";
      }
    });
  </script>
</body>
</html>
